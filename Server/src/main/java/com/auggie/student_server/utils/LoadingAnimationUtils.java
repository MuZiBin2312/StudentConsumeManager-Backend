package com.auggie.student_server.utils;

import java.util.concurrent.atomic.AtomicBoolean;
import java.util.concurrent.TimeUnit;

public class LoadingAnimationUtils {
    private static final String[] PROGRESS_BAR = {
            "[█-----------------------------------------------------------]",
            "[██----------------------------------------------------------]",
            "[███---------------------------------------------------------]",
            "[████--------------------------------------------------------]",
            "[█████-------------------------------------------------------]",
            "[██████------------------------------------------------------]",
            "[███████-----------------------------------------------------]",
            "[████████----------------------------------------------------]",
            "[█████████---------------------------------------------------]",
            "[██████████--------------------------------------------------]",
            "[-██████████-------------------------------------------------]",
            "[--██████████------------------------------------------------]",
            "[---██████████-----------------------------------------------]",
            "[----██████████----------------------------------------------]",
            "[-----██████████---------------------------------------------]",
            "[------██████████--------------------------------------------]",
            "[-------██████████-------------------------------------------]",
            "[--------██████████------------------------------------------]",
            "[---------██████████-----------------------------------------]",
            "[----------██████████----------------------------------------]",
            "[-----------██████████---------------------------------------]",
            "[------------██████████--------------------------------------]",
            "[-------------██████████-------------------------------------]",
            "[--------------██████████------------------------------------]",
            "[---------------██████████-----------------------------------]",
            "[----------------██████████----------------------------------]",
            "[-----------------██████████---------------------------------]",
            "[------------------██████████--------------------------------]",
            "[-------------------██████████-------------------------------]",
            "[--------------------██████████------------------------------]",
            "[---------------------██████████-----------------------------]",
            "[----------------------██████████----------------------------]",
            "[-----------------------██████████---------------------------]",
            "[------------------------██████████--------------------------]",
            "[-------------------------██████████-------------------------]",
            "[--------------------------██████████------------------------]",
            "[---------------------------██████████-----------------------]",
            "[----------------------------██████████----------------------]",
            "[-----------------------------██████████---------------------]",
            "[------------------------------██████████--------------------]",
            "[-------------------------------██████████-------------------]",
            "[--------------------------------██████████------------------]",
            "[---------------------------------██████████-----------------]",
            "[----------------------------------██████████----------------]",
            "[-----------------------------------██████████---------------]",
            "[------------------------------------██████████--------------]",
            "[-------------------------------------██████████-------------]",
            "[--------------------------------------██████████------------]",
            "[---------------------------------------██████████-----------]",
            "[----------------------------------------██████████----------]",
            "[-----------------------------------------██████████---------]",
            "[------------------------------------------██████████--------]",
            "[-------------------------------------------██████████-------]",
            "[--------------------------------------------██████████------]",
            "[---------------------------------------------██████████-----]",
            "[----------------------------------------------██████████----]",
            "[-----------------------------------------------██████████---]",
            "[------------------------------------------------██████████--]",
            "[-------------------------------------------------██████████-]",
            "[--------------------------------------------------██████████]",
            "[---------------------------------------------------█████████]",
            "[----------------------------------------------------████████]",
            "[-----------------------------------------------------███████]",
            "[------------------------------------------------------██████]",
            "[-------------------------------------------------------█████]",
            "[--------------------------------------------------------████]",
            "[---------------------------------------------------------███]",
            "[----------------------------------------------------------██]",
            "[-----------------------------------------------------------█]",
            "[-----------------------------------------------------------█]",
            "[----------------------------------------------------------██]",
            "[---------------------------------------------------------███]",
            "[--------------------------------------------------------████]",
            "[-------------------------------------------------------█████]",
            "[------------------------------------------------------██████]",
            "[----------------------------------------------------████████]",
            "[---------------------------------------------------█████████]",
            "[--------------------------------------------------██████████]",
            "[-------------------------------------------------██████████-]",
            "[------------------------------------------------██████████--]",
            "[-----------------------------------------------██████████---]",
            "[----------------------------------------------██████████----]",
            "[---------------------------------------------██████████-----]",
            "[--------------------------------------------██████████------]",
            "[-------------------------------------------██████████-------]",
            "[------------------------------------------██████████--------]",
            "[-----------------------------------------██████████---------]",
            "[----------------------------------------██████████----------]",
            "[---------------------------------------██████████-----------]",
            "[--------------------------------------██████████------------]",
            "[-------------------------------------██████████-------------]",
            "[------------------------------------██████████--------------]",
            "[-----------------------------------██████████---------------]",
            "[----------------------------------██████████----------------]",
            "[---------------------------------██████████-----------------]",
            "[--------------------------------██████████------------------]",
            "[-------------------------------██████████-------------------]",
            "[------------------------------██████████--------------------]",
            "[-----------------------------██████████---------------------]",
            "[----------------------------██████████----------------------]",
            "[---------------------------██████████-----------------------]",
            "[--------------------------██████████------------------------]",
            "[-------------------------██████████-------------------------]",
            "[------------------------██████████--------------------------]",
            "[-----------------------██████████---------------------------]",
            "[----------------------██████████----------------------------]",
            "[---------------------██████████-----------------------------]",
            "[--------------------██████████------------------------------]",
            "[-------------------██████████-------------------------------]",
            "[------------------██████████--------------------------------]",
            "[-----------------██████████---------------------------------]",
            "[----------------██████████----------------------------------]",
            "[---------------██████████-----------------------------------]",
            "[--------------██████████------------------------------------]",
            "[-------------██████████-------------------------------------]",
            "[------------██████████--------------------------------------]",
            "[-----------██████████---------------------------------------]",
            "[----------██████████----------------------------------------]",
            "[---------██████████-----------------------------------------]",
            "[--------██████████------------------------------------------]",
            "[-------██████████-------------------------------------------]",
            "[------██████████--------------------------------------------]",
            "[-----██████████---------------------------------------------]",
            "[----██████████----------------------------------------------]",
            "[---██████████-----------------------------------------------]",
            "[--██████████------------------------------------------------]",
            "[-██████████-------------------------------------------------]",
            "[██████████--------------------------------------------------]",
            "[█████████---------------------------------------------------]",
            "[████████----------------------------------------------------]",
            "[███████-----------------------------------------------------]",
            "[██████------------------------------------------------------]",
            "[█████-------------------------------------------------------]",
            "[████--------------------------------------------------------]",
            "[███---------------------------------------------------------]",
            "[██----------------------------------------------------------]",
            "[█-----------------------------------------------------------]",


    };
//    private static final String[] PROGRESS_BAR = {
//            "|     █     ░     -     -     -     -     -     -     ◯",
//            "/     ░     █     ░     -     -     -     -     -     ◔",
//            "-     -     ░     █     ░     -     -     -     -     ◑",
//            "\\     -     -     ░     █     ░     -     -     -     ◕",
//            "|     -     -     ░     ░     █     ░     -     -     ◯",
//            "/     -     -     -     ░     █     ░     ░     -     ◔",
//            "-     -     -     -     ░     ░     █     ░     -     ◑",
//            "\\     -     -     -     -     ░     ░     █     ░     ◕"
//    };
//    private static final String[] SIMPLE_SPINNER = {
//            "|            ◯            ⧗            ◜            ↑            ↖            ❇            ★",
//            "/            ◔            ⧘            ◝            →            ↗            ✦            ☆",
//            "-            ◑            ⧙            ◞            ↓            ↘            ✸            ✪",
//            "\\            ◕            ⧚            ◟            ←            ↙            ✵            ✰"
//    };

    private static final AtomicBoolean running = new AtomicBoolean(false);

    // 启动简化的转圈动画
    public static void showLoadingAnimation(boolean isIdle) throws InterruptedException {
        if (!running.get()) {
            running.set(true);
            new Thread(() -> {
                System.out.print("\033[?25l"); // 隐藏光标
                String message = isIdle ? "空闲中..." : "加载中..."; // 根据状态显示不同提示
                try {
                    while (running.get()) {
                        // 打印当前的旋转效果
                        for (String frame : PROGRESS_BAR) {
                            if (!running.get()) break; // 退出动画
                            System.out.printf("\r%s %s", message, frame); // 输出当前帧
                            TimeUnit.MILLISECONDS.sleep(90); // 控制动画帧的刷新速度
                        }
                    }
                } catch (InterruptedException e) {
                    Thread.currentThread().interrupt();
                } finally {
                    System.out.print("\033[?25h"); // 恢复光标
                }
            }).start();
        }
    }

    // 停止动画
    public static void stopAnimation() {
        running.set(false);
    }
}